# Graphite Apache Virtual Host
#
# Generated by Chef

# You may need to manually edit this file to fit your needs.

<VirtualHost <%= node['graphite']['web']['interface'] %>:<%= node['graphite']['web']['port'] %>>
        ServerName <%= node['graphite']['web']['host'] %>
        DocumentRoot "<%= node['graphite']['base_dir'] %>/webapp"
        ErrorLog <%= node['graphite']['storage_dir'] %>/log/webapp/error.log
        CustomLog <%= node['graphite']['storage_dir'] %>/log/webapp/access.log common

        <Location "/">
                SetHandler python-program
                PythonPath "['<%= node['graphite']['base_dir'] %>/webapp'] + sys.path"
                PythonHandler django.core.handlers.modpython
                SetEnv DJANGO_SETTINGS_MODULE graphite.settings
                SetEnv GRAPHITE_STORAGE_DIR <%= node['graphite']['storage_dir'] %>/
                PythonDebug Off
                PythonAutoReload Off
        </Location>

        <Location "/content/">
                SetHandler None
        </Location>

        <Location "/media/">
                SetHandler None
        </Location>

        <% if node['recipes'].include? "ganglia::web" -%>
	<Location "/ganglia/">
	        SetHandler None
	</Location>
        <% end -%>

  <% if node['gdash']['prefix'] -%>
    <Location "<%= node['gdash']['prefix'] %>">
      Order allow,deny
      Allow from all
      SetHandler None
    </Location>

    ProxyPass              <%= node['gdash']['prefix'] %>  http://<%= node['gdash']['interface'] %>:<%= node['gdash']['port'] %>
    ProxyPassReverse       <%= node['gdash']['prefix'] %>  http://<%= node['gdash']['interface'] %>:<%= node['gdash']['port'] %>
  <% end -%>



</VirtualHost>
